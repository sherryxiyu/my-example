#include<reg51.h>
sbit p1_0=P1^0;	
sbit p1_1=P1^1;
sbit p1_2=P1^2;
unsigned int i=100;
void main(void)
{
	EA=1;
	ET0=1;
	TMOD=0x01;
	TH0=0x3c;
	TL0=0xb0;
	P1=0xff;
	P3=0xff;  
	while (1)
	{
		if((P3==0xfe)&&(p1_1!=0)&&(p1_0!=0))//限制只有在停止状态及关门中才能启动开门程序
		  {
	     p1_2=1;
		   p1_0=0;//红灯亮，开门  
	    } 
		if((P3==0xfd)&&(p1_1!=0)&&(p1_2!=0))//限制在红灯亮过后的状态才能点亮黄灯（即行程开关，按此按钮表示门完全打开）
			 {
					 p1_0=1;//门完全打开
					 i=100;
					 TR0=1;
		       p1_1=0;//黄灯亮，开门中
			 }
		if((P3==0xfb)&&(p1_1!=0)&&(p1_0!=0))//限制在绿灯亮的状态下关灯（即行程开关，按此按钮表示门完全关闭）
		  {
			  p1_2=1;//门完全关闭
		  }
	}
}
void timeer() interrupt 1
{
	  TH0=0x3c;
	  TL0=0xb0;
	  i--;
	  if(i==0)
		{
			p1_1=1;
		  p1_2=0;//绿灯亮，关门中
    }
}